{% extends "layout/base.html" %}
{% block title %}{{ bank.name }} ‚Äì Bank Log{% endblock %}

{% block content %}

<h4 class="mb-3">
    Bank Log ‚Äì <span class="text-primary">{{ bank.name }}</span>
</h4>

<!-- üîç FILTER FORM -->
<form method="get" class="row g-3 mb-4 align-items-end">

    <!-- üë§ CLIENT -->
    <div class="col-md-3">
        <label class="form-label">Client</label>
        <select name="client" class="form-select">
            <option value="">All Clients</option>
            {% for c in clients %}
                <option value="{{ c.id }}"
                    {% if selected_client == c.id|stringformat:"s" %}selected{% endif %}>
                    {{ c.name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- üìÖ START DATE -->
    <div class="col-md-3">
        <label class="form-label">Start Date</label>
        <input type="date"
               name="start_date"
               value="{{ start_date }}"
               class="form-control">
    </div>

    <!-- üìÖ END DATE -->
    <div class="col-md-3">
        <label class="form-label">End Date</label>
        <input type="date"
               name="end_date"
               value="{{ end_date }}"
               class="form-control">
    </div>

    <!-- üîò ACTIONS -->
    <div class="col-md-3 d-flex gap-2">
        <button class="btn btn-primary w-100">Apply</button>
        <a href="{% url 'bank_log' bank.id %}"
           class="btn btn-secondary w-100">
            Reset
        </a>
    </div>

</form>

<!-- üìä BANK SUMMARY -->
<div class="card mb-3  bg-primary text-white shadow-sm">
    <div class="card-body text-center">
        <h6 class="text-white mb-1">Current Available Balance</h6>
        <h3 class="fw-bold text-white">
            ‚Çπ {{ bank.available_balance|floatformat:2 }}
        </h3>
    </div>
</div>

<!-- üìã BANK TRANSACTIONS -->
<div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
<table class="table table-bordered table-hover align-middle">
    <thead class="table-primary sticky-top">
        <tr>
            <th>#</th>
            <th>Date</th>
            <th>Client</th>
            <th>Type</th>
            <th>Description</th>
            <th class="text-end">Credit</th>
            <th class="text-end">Debit</th>
            <th class="text-end">Running Balance</th>
        </tr>
    </thead>

    <tbody>
        {% for row in logs %}
        <tr>
            <td>{{ forloop.counter }}</td>

            <!-- DATE -->
            <td>{{ row.txn_date|date:"d M Y" }}</td>

            <!-- CLIENT -->
            <td>{{ row.client_name }}</td>

            <!-- TYPE -->
            <td>
                <span class="badge
                    {% if row.txn_type == 'Payment' %}
                        bg-success
                    {% else %}
                        bg-danger
                    {% endif %}">
                    {{ row.txn_type }}
                </span>
            </td>

            <!-- DESCRIPTION -->
            <td>{{ row.txn_description }}</td>

            <!-- CREDIT -->
            <td class="text-end text-success fw-semibold">
                {% if row.credit %}
                    ‚Çπ {{ row.credit|floatformat:2 }}
                {% else %}
                    ‚Äî
                {% endif %}
            </td>

            <!-- DEBIT -->
            <td class="text-end text-danger fw-semibold">
                {% if row.debit %}
                    ‚Çπ {{ row.debit|floatformat:2 }}
                {% else %}
                    ‚Äî
                {% endif %}
            </td>

            <!-- RUNNING BALANCE -->
            <td class="text-end fw-bold
                {% if row.balance < 0 %}
                    text-danger
                {% else %}
                    text-success
                {% endif %}">
                ‚Çπ {{ row.balance|floatformat:2 }}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="8" class="text-center text-muted">
                No transactions found
            </td>
        </tr>
        {% endfor %}
    </tbody>

</table>
</div>

<div class="d-flex justify-content-between">
<a href="{% url 'bank_index' %}" class="btn btn-primary mt-3 mb-3" style="vertical-align: center;">
    ‚Üê Back to Banks
</a>

<a href="{% url 'bank_log_pdf' bank.id %}?client={{ selected_client }}&start_date={{ start_date }}&end_date={{ end_date }}"
   class="btn btn-danger mb-3 mt-3">
   üìÑ Export PDF
</a>

</div>
{% endblock %}
