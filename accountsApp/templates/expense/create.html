{% extends "layout/base.html" %}
{% block title %}Create Expense{% endblock %}

{% block content %}
<div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
        Create Expense
    </div>

    <div class="card-body">
        <form method="POST" id="expenseForm">
            {% csrf_token %}

            <!-- CLIENT -->
            <div class="mb-3">
                <label class="form-label">Client</label>
                <select name="client" class="form-select" required>
                    <option value="">Select Client</option>
                    {% for client in clients %}
                        <option value="{{ client.id }}">{{ client.name }} ({{ client.company.name }})</option>
                    {% endfor %}
                </select>
            </div>

            <!-- SPEND MODE -->
            <div class="mb-3">
                <label class="form-label">Spend Mode</label>
                <select name="spend_mode" id="spend_mode" class="form-select" required>
                    <option value="cash">Cash</option>
                    <option value="cheque">Cheque</option>
                </select>
            </div>

            <!-- BANK -->
            <div class="mb-3">
                <label class="form-label">Bank</label>
                <select name="bank" id="bank_select" class="form-select">
                    <option value="">Cash</option>
                    {% for bank in banks %}
                        <option value="{{ bank.id }}">{{ bank.name }}</option>
                    {% endfor %}
                </select>

                <small id="cashWarning" class="text-danger d-none">
                    Bank must be <strong>Cash</strong> for cash expense.
                </small>

                <small id="chequeWarning" class="text-danger d-none">
                    Please select a <strong>bank</strong> for cheque expense.
                </small>
            </div>

            <!-- CATEGORY -->
            <div class="mb-3">
                <label class="form-label">Category</label>
                <select name="category" class="form-select" required>
                    <option value="">Select Category</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- DESCRIPTION -->
            <div class="mb-3">
                <label class="form-label">Description</label>
                <textarea name="description" class="form-control" rows="3" required></textarea>
            </div>

            <!-- AMOUNT -->
            <div class="mb-3">
                <label class="form-label">Amount</label>
                <input type="number" step="0.01" name="amount" class="form-control" required>
            </div>

            <!-- DATE -->
            <div class="mb-3">
                <label class="form-label">Spend Date</label>
                <input type="date" name="expense_date" class="form-control" required>
            </div>

            <button class="btn btn-success">Save</button>
            <a href="{% url 'expense_index' %}" class="btn btn-secondary">Back</a>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const spendMode = document.getElementById('spend_mode');
    const bankSelect = document.getElementById('bank_select');
    const cashWarning = document.getElementById('cashWarning');
    const chequeWarning = document.getElementById('chequeWarning');
    const form = document.getElementById('expenseForm');

    function validateSelection() {
        cashWarning.classList.add('d-none');
        chequeWarning.classList.add('d-none');

        if (spendMode.value === 'cash') {
            bankSelect.value = '';
            bankSelect.disabled = true;
        } else {
            bankSelect.disabled = false;
        }

        if (spendMode.value === 'cash' && bankSelect.value !== '') {
            cashWarning.classList.remove('d-none');
            return false;
        }

        if (spendMode.value === 'cheque' && bankSelect.value === '') {
            chequeWarning.classList.remove('d-none');
            return false;
        }

        return true;
    }

    spendMode.addEventListener('change', validateSelection);
    bankSelect.addEventListener('change', validateSelection);

    form.addEventListener('submit', function (e) {
        if (!validateSelection()) {
            e.preventDefault();
        }
    });

    // initial state
    validateSelection();
});
</script>

{% endblock %}
